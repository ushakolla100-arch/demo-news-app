@model SearchNewsApp.Models.NewsViewModel

<h1>Search News</h1>

<form method="get">
    <input type="text" name="query" value="@Model.Query" placeholder="Search news..." />
    <button type="submit">Search</button>
</form>

@if (Model.SearchResults.Any())
{
    <h2>Search Results</h2>
    <ul id="searchResults">
        @foreach (var article in Model.SearchResults)
        {
            <li data-id="@article.Id">
                <a href="@article.Url" target="_blank">@article.Title</a>
                <p>@Html.Raw(article.Description)</p>
                <small>@article.PublishedAt</small>
                <button type="button" class="pinBtn">Pin</button>
            </li>
        }
    </ul>
}

<h2>Pinned Articles</h2>
<ul id="pinnedArticles">
    @if (Model.PinnedArticles.Any())
    {
        @foreach (var article in Model.PinnedArticles)
        {
            <li data-id="@article.Id">
                <a href="@article.Url" target="_blank">@article.Title</a>
                <p>@Html.Raw(article.Description)</p>
                <small>@article.PublishedAt</small>
            </li>
        }
    }
</ul>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const pinnedContainer = document.getElementById('pinnedArticles');
            const searchResults = document.getElementById('searchResults');

            if (searchResults && pinnedContainer) {
                searchResults.querySelectorAll('.pinBtn').forEach(btn => {
                    btn.addEventListener('click', function () {
                        const articleLi = this.parentElement;

                        // Prevent duplicates
                        const articleId = articleLi.getAttribute('data-id');
                        if (!pinnedContainer.querySelector(`li[data-id="${articleId}"]`)) {
                            pinnedContainer.appendChild(articleLi);
                            this.remove(); // remove Pin button
                        }
                    });
                });
            }
        });
    </script>
}
